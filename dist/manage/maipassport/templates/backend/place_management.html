{% extends 'backend/base.html' %}
{% load i18n %}
{% load static %}
{% load utils %}
{% block stylesheet %}
    <style>
        .modal {
            text-align: center;
            padding: 0!important;
        }

        .modal:before {
            content: '';
            display: inline-block;
            height: 100%;
            vertical-align: middle;
            margin-right: -4px;
        }

        .modal-dialog {
            display: inline-block;
            text-align: left;
            vertical-align: middle;
        }

        nav ul.mainNav > li {
            z-index: 100;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-sm-10 col-xs-10 bread-sec">
                <a href="{% url 'backend_index' %}" style="color:#868686;text-decoration: none;"> 首頁 </a>><a style="color:#868686;text-decoration: none;"> 系統管理 </a>><a href="{% url 'place_management' %}" style="color:#868686;text-decoration: none;"> 地點管理 </a>
{#                ><a href="#" style="color:#868686;text-decoration: none;">部門晉升提報與查詢</a> </div>#}
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12 " style="margin: 20px 0 20px 0px;font-size:25px; "> 地點管理 <img src="{% static 'backend/images/LINE.png' %}" class="img-responsive top5" alt="" /> </div>
        </div>
    </div>
    <div class="container bottom40">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12 " >
                <div style="font-size: 15px;">
                    <div class=" col-lg-12 col-xs-12 ">
                        <form class="form-horizontal"  method="get" id="frm">
                            <input type="hidden" value="{{ request.GET.per_page_num }}" id="per_page_num" name="per_page_num">
                            <div class="form-group ">
                                <div class="col-md-12">
                                    <div class="col-md-4">
                                        <input class="form-control form-control pull-left sndMt10" type="text" list="place_list" name="place_name" id="place_name" placeholder="{% trans 'Please Select Location' %}" autocomplete="off" value="{{ request.GET.place_name }}">
                                        <datalist  id="place_list">
                                            <option value="">無</option>
                                            {% for place_name_show in place_name_list %}
                                                <option value="{{ place_name_show }}">{{ place_name_show }}</option>
                                            {% endfor %}
                                        </datalist>
                                    </div>
                                    <div class="col-md-4">
                                        <input class="form-control form-control pull-left sndMt10" type="text" name="place_address" id="place_address" placeholder="{% trans 'Please Enter Address' %}" autocomplete="off" value="{{ request.GET.place_address }}">
                                    </div>
                                    <div class="col-md-4">
                                        {#<input type="text" class="form-control inputBox form-control pull-left sndMt10" placeholder="地點名稱" id="place_name" name="place_name" value="{{ request.GET.place_name }}">#}
                                        <select class="form-control selectpicker" name="company_name" id="company_name" data-live-search="true" title="{% trans 'Please Select Company / School' %}">
                                            <option value="">無</option>
                                            {% for company in company_list %}
                                                <option {% if request.GET.company_name == company.name %}selected{% endif %} value="{{ company.name }}">{{ company.name }}</option>
                                            {% endfor %}
                                        </select>

                                    </div>
                                </div>
                                <div class="col-md-12">
                                    <div style="height: 30px;"></div>
                                    <div class="col-md-12 text-right">
                                        <button type="button" class="btn btn-default" style="background:#8b8c8c;color:#fff; " onclick="reset_frm()">清除搜尋</button>
                                        <button type="submit" class="btn btn-default" style="background:#6fa1bf;color:#fff; ">搜尋地點</button>
                                    </div>
                                </div>

                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
{#        <div class="col-12">#}
{#            <div class="col-2">#}
{#                <button type="submit" class="btn btn-default" style="background:#335eb6;color:#fff; ">更新後台管理者</button>#}
{#                <button type="submit" class="btn btn-default" style="background:#8b8c8c;color:#fff; ">搜尋使用者</button>#}
{#            </div>#}
{#        </div>#}

        <div class="pc_top row top20">
            <div class="col-md-12 col-sm-12 col-xs-12 " style="font-size: 16px;">
                <form method="post" id="print_frm" action="{% url 'print_view' 'PLACE' 'ADMIN' %}">
                {% csrf_token %}
                    <div class="form-group ">
                        <div class="col-md-12 text-left">
                            <button type="button" class="btn btn-default" style="background:#354bbf;color:#fff; " onclick="print_place()" id="print_btn">列印選取地點(已選取0項，最多10項)</button>
                            <button type="button" class="btn btn-default" style="background:#8b8c8c;color:#fff; " onclick="clear_checked()">清除選取</button>
                        </div>
                    </div>
                </form>
                <table class="table table-striped table-bordered" >
                    {#                    <thead>#}
                    <tr>
                        {#                            <th class="cen_blue">#}
                        {#                                <label><input type="checkbox" id="all_check">&nbsp;後台管理者</label>#}
                        {#                                後台管理者#}
                        {#                            </th>#}
                        <th class="text-center cen_blue" style="width: 5%;">列印  <input type="checkbox" id="CheckAll" onclick="all_checked()"></th>
                        <th class="text-center cen_blue" style="width: 23%;">地點名稱</th>
                        <th class="text-center cen_blue" style="width: 23%;">地址</th>
                        <th class="text-center cen_blue" style="width: 10%;">審核狀態</th>
                        <th class="text-center cen_blue" style="width: 17%;">所屬公司</th>
{#                        <th class="text-center cen_blue" style="width: 30%;">QR Code內容</th>#}
                        <th class="text-center cen_blue" style="width: 15%;">功能</th>
                    </tr>
                    {#                    </thead>#}
                    {% for place in place_list %}
                        <tr>
                            <td class="cen text-center">
                                {% if place.company_verify %}
                                    <input type="checkbox" id="print_place_{{ place.pub_id }}" name="Checkbox[]" value="{{ place.pub_id }}" onclick="check_place_cookie('{{ place.pub_id }}')" {% if place.pub_id in request.session.check_place %}checked{% endif %}>
                                {% endif %}
                            </td>
                            <td class="cen text-center">{{ place.name }}</td>
                            <td class="cen text-center">
                                {% if place.location.location_address %}
                                    {{ place.location.location_address }}
                                {% endif %}
                            </td>
                            <td class="cen text-center">
                                {% if place.company_verify == 1 %}
                                    {% trans 'Approved' %}
                                {% elif place.company_verify == 0 %}
                                    {% trans 'Waiting' %}
                                {% elif place.company_verify == 2 %}
                                    {% trans 'Not Approved' %}
                                {% endif %}
                            </td>
                            <td class="cen text-center">
                                {% if place.company.pub_id %}
                                    <a href="{% url 'company_detail' place.company.pub_id %}">{{ place.company.name }}</a>
                                {% endif %}
                            </td>
{#                            <td class="cen text-center"><a onclick="get_qr_img('{{ place.pub_id }}')" data-toggle="modal" data-target="#qr_img_modal" style="text-decoration:none; cursor: pointer;">PLACE__{{ place.pub_id }} <i class="fas fa-search"></i></a></td>#}
                            <td class="cen text-center">
                                {% if place.company_verify == 1 %}
                                    <a onclick="get_qr_img('{{ place.pub_id }}')" data-toggle="modal" data-target="#qr_img_modal" style="text-decoration:none; cursor: pointer;"><i class="fas fa-qrcode"></i></a>
                                    <a onclick="place_tract('{{ place.name }}')" style="cursor: pointer;" title="追蹤"><i class="fas fa-list-alt"></i></a>
                                    <a onclick="open_edit_place_modal('{{ place.pub_id }}', '{{ place.update_health_code }}', '{{ place.name }}', '{{ place.location.location_address }}', '{{ place.place_user.auth_user.first_name }}', '{{ place.place_contact_phone }}')" data-toggle="modal" data-target="#edit_place" style="cursor: pointer;" title="編輯地點名稱"><i class="fas fa-edit"></i></a>
                                    <a onclick="open_del_place_modal('{{ place.pub_id }}')" data-toggle="modal" data-target="#del_place" style="cursor: pointer;" title="刪除地點"><i class="fas fa-times"></i></a>
                                {% elif place.company_verify == 0 %}
                                    <a onclick="open_verify_place_modal('{{ place.pub_id }}', '{{ place.name }}', '{{ place.address }}', '{{ place.company.name }}', '{{ place.place_user.auth_user.firstname }}', '{{ place.place_contact_phone }}')"
                                       data-toggle="modal" data-target="#verify_place_modal" style="text-decoration:none; cursor: pointer;"><i class="fas fa-edit"></i></a>
                                {% else %}
                                    <a onclick="open_del_place_modal('{{ place.pub_id }}')" data-toggle="modal" data-target="#del_place" style="cursor: pointer;" title="刪除地點"><i class="fas fa-times"></i></a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                    <tr>
                        <td class="cen text-center" colspan="6"><a onclick="open_add_place_modal()" data-toggle="modal" data-target="#add_place" style="text-decoration:none; cursor: pointer;" ><i class="fas fa-plus"></i> 新增地點</a></td>
                        {#                            <td class="cen text-center"></td>#}
                        {#                            <td class="cen text-center"></td>#}
                    </tr>
                </table>
            </div>
            <div class="col-md-1"></div>
            <div class="col-md-11 col-xs-12 top10 ">
                <ul class="pagination" style="float: left;">
                    <li class="page-item {% if place_list.number == 1 %}disabled{% endif %}">
                        <a href="{{ request.get_full_path|change_page:1 }}" aria-label="Previous">首頁 </a>
                    </li>
                    <li class="page-item {% if not place_list.has_previous %}disabled{% endif %}">
                        {% if place_list.has_previous %}
                            <a href="{{ request.get_full_path|change_page:place_list.previous_page_number }}" aria-label="Previous">上頁 </a>
                        {% else %}
                            <a href="#" aria-label="Previous">上頁 </a>
                        {% endif %}
                    </li>
                    {% for num in page_range %}
                        <li class="page-item {% if num == place_list.number %}active{% endif %}"><a href="{{ request.get_full_path|change_page:num }}">{{ num }}</a></li>
                    {% endfor %}
                    <li class="page-item {% if not place_list.has_next %}disabled{% endif %}">
                        {% if place_list.has_next %}
                            <a href="{{ request.get_full_path|change_page:place_list.next_page_number }}" aria-label="Next">下頁 </a>
                        {% else %}
                            <a href="#" aria-label="Next">下頁 </a>
                        {% endif %}
                    </li>
                    <li class="page-item {% if place_list.number == place_list.paginator.num_pages or place_list.paginator.num_pages == 1 %}disabled{% endif %}" >
                        <a href="{{ request.get_full_path|change_page:place_list.paginator.num_pages }}" aria-label="Next">末頁 </a>
                    </li>
                </ul>
                <div class="col-md-5 top20">
                    <div style="color:#000;float: left;margin:10px  ">每頁顯示</div>
                    <div class="col-md-4 col-xs-12 bottom10">
                        <select class="form-control selectpicker" onchange="resize_list_num()" id="per_page_num_sel">
                            <option {% if request.GET.per_page_num == '10' %}selected{% endif %} value="10">10</option>
                            <option {% if request.GET.per_page_num == '20' %}selected{% endif %} value="20">20</option>
                        </select>
                    </div>
                    <div style="color:#000;float: left;margin:10px  ">筆(共{% if user_length %}{{ user_length }}{% else %}0{% endif %}筆)</div>
                </div>
            </div>
        </div>
        <div class="mobile_top row top20">
            <table class="table table-striped table-bordered" >
                <tr>
                    <th class="text-center cen_blue" style="width: 23%;">地點名稱</th>
                    <th class="text-center cen_blue" style="width: 10%;">地點編號</th>
                    <th class="text-center cen_blue" style="width: 17%;">所屬公司</th>
                    <th class="text-center cen_blue" style="width: 15%;">功能</th>
                </tr>
                {% for place in place_list %}
                    <tr>
                        <td class="cen text-center">{{ place.name }}</td>
                        <td class="cen text-center">{{ place.serial_num }}</td>
                        <td class="cen text-center">
                            {% if place.company.pub_id %}
                                <a href="{% url 'company_detail' place.company.pub_id %}">{{ place.company.name }}</a></td>
                            {% endif %}
                        <td class="cen text-center" colspan="3">
                            <a onclick="get_qr_img('{{ place.pub_id }}')" data-toggle="modal" data-target="#qr_img_modal" style="text-decoration:none; cursor: pointer;"><i class="fas fa-search"></i></a>
                            <a onclick="place_tract('{{ place.name }}')" style="cursor: pointer;" title="追蹤"><i class="fas fa-list-alt"></i></a>
                            <a onclick="open_edit_place_modal('{{ place.pub_id }}', '{{ place.update_health_code }}', '{{ place.name }}', '{{ place.location.location_address }}')" data-toggle="modal" data-target="#edit_place" style="cursor: pointer;" title="編輯地點名稱"><i class="fas fa-edit"></i></a>
                            <a onclick="open_del_place_modal('{{ place.pub_id }}')" data-toggle="modal" data-target="#del_place" style="cursor: pointer;" title="刪除地點"><i class="fas fa-times"></i></a>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <!-- DialogIconedInfo -->
    <div class="modal fade" id="qr_img_modal" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <label class="modal-title text-template" id="exampleModalLabel">地點QR Code</label>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" >
                        <div class="row">
                            <div class="col text-center">
                                <label id="qr_info" style="font-size: 20px;" ></label>
                            </div>
                            <div class="col text-center">
                                <img id="qr_image" height="40%" width="80%" alt="">
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="edit_place" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <label class="modal-title text-template" id="exampleModalLabel">編輯地點</label>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" >
                        <div class="row">
                            <div class="col-md-12">
                                <form class="form-horizontal" id="edit_place_frm" action="{% url 'edit_place' 'EDIT' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" value="{{ request.GET.page }}" name="edit_now_page">
                                    <input type="hidden" value="{{ request.GET.per_page_num }}" name="edit_now_page_range">
                                    <input type="hidden" value="{{ request.GET.place_name }}" name="edit_search_place_name">
                                    <input type="hidden" value="{{ request.GET.place_address }}" name="edit_search_place_address">
                                    <input type="hidden" value="{{ request.GET.company_name }}" name="edit_search_company_name">
                                    <div class="form-group">
{#                                        <div class="col-md-3 ">#}
{#                                            <label class="control-label"> 修改地點名稱</label>#}
{#                                        </div>#}
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="地點名稱" id="edit_place_name" name="edit_place_name">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="地址" id="edit_place_address" name="edit_place_address">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="使用者名稱" id="edit_place_user" name="edit_place_user" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="使用者電話" id="edit_place_contact_phone" name="edit_place_contact_phone">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="checkbox" id="edit_update_enabled" name="edit_update_enabled">&nbsp;自動更新健康碼為正常
                                        </div>
                                        <input type="hidden" id="edit_place_id" name="edit_place_id">
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="edit_place_modal()">確定</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="del_place" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <label class="modal-title text-template" id="exampleModalLabel">刪除地點</label>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" >
                        <div class="row">
                            <div class="col-md-12">
                                <form class="form-horizontal">
                                    <div class="form-group">
{#                                        <label for="exampleInputPassword1" class="col-md-3 control-label"> 修改地點名稱</label>#}
                                        <div class="col-md-12">
                                            <h4 class="control-label col-md-4">確定要刪除嗎？</h4>
                                        </div>

                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <form action="{% url 'edit_place' 'DEL' %}" method="post">
                            {% csrf_token %}
                            <input type="hidden" value="{{ request.GET.page }}" name="del_now_page">
                            <input type="hidden" value="{{ request.GET.per_page_num }}" name="del_now_page_range">
                            <input type="hidden" value="{{ request.GET.place_name }}" name="del_search_place_name">
                            <input type="hidden" value="{{ request.GET.place_address }}" name="del_search_place_address">
                            <input type="hidden" value="{{ request.GET.company_name }}" name="del_search_company_name">
                            <button type="submit" class="btn btn-secondary" >是</button>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">否</button>
                            <input type="hidden" id="del_place_id" name="del_place_id">
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="add_place" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <label class="modal-title text-template" id="exampleModalLabel">新增地點</label>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" >
                        <div class="row">
                            <div class="col-md-12">
                                <form class="form-horizontal" id="add_place_frm" action="{% url 'edit_place' 'ADD' %}" method="post">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="地點名稱" name="add_place_name" id="add_place_name">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="地址" id="add_place_address" name="add_place_address">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <select class="form-control selectpicker" name="company_id" id="company_id" data-live-search="true" title="{% trans 'Please Select Company / School' %}" required>
                                                <option value="">無</option>
                                                {% for company in company_list %}
                                                    <option value="{{ company.pub_id }}">{{ company.name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
{#                                        <input type="hidden" id="add_place_name" name="add_place_name">#}
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" onclick="add_place_modal()">確定</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="verify_place_modal" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
            aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <label class="modal-title text-template" id="exampleModalLabel">審核地點</label>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" >
                        <div class="row">
                            <div class="col-md-12">
                                <form class="form-horizontal" id="verify_place_frm" action="{% url 'place_verify' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="verify_place_pub_id" id="verify_place_pub_id">
                                    <input type="hidden" name="verify_status" id="verify_status">
                                    <input type="hidden" value="{{ auth_user.username }}" name="user_account" id="user_account">
                                    <input type="hidden" value="{{ request.GET.page }}" name="verify_now_page">
                                    <input type="hidden" value="{{ request.GET.per_page_num }}" name="verify_now_page_range">
                                    <input type="hidden" value="{{ request.GET.place_name }}" name="verify_search_place_name">
                                    <input type="hidden" value="{{ request.GET.place_address }}" name="verify_search_place_address">
                                    <input type="hidden" value="{{ request.GET.company_name }}" name="verify_search_company_name">
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="地點名稱" name="verify_place_name" id="verify_place_name" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="地址" id="verify_place_address" name="verify_place_address">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
{#                                            <select class="form-control selectpicker" name="verify_company_id" id="verify_company_id" data-live-search="true" title="{% trans 'Please Select Company / School' %}" required>#}
{#                                                <option value="" >無</option>#}
{#                                                {% for company in company_list %}#}
{#                                                    <option value="{{ company.pub_id }}" {% if place.company.pub_id == company.pub_id %}selected{% endif %}>{{ company.name }}</option>#}
{#                                                {% endfor %}#}
{#                                            </select>#}
                                            <input type="text" class="form-control" placeholder="公司 / 學校" id="verify_place_company_name" readonly>
                                        </div>
{#                                        <input type="hidden" id="add_place_name" name="add_place_name">#}
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="使用者" id="verify_place_user" readonly>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-12">
                                            <input type="text" class="form-control" placeholder="聯絡電話" id="verify_place_phone" name="verify_place_phone">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-success" onclick="verify_place_submit('YES')">通過申請</button>
                        <button type="button" class="btn btn-danger" onclick="verify_place_submit('NO')">否決申請</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                    </div>
                </div>
            </div>
        </div>
    <!-- * DialogIconedInfo -->

    <!-- Modal -->

    <div class="modal fade" id="send_notify" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <label class="modal-title text-template" id="exampleModalLabel">小提示</label>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" >
                    <div class="row">
                        <div class="col text-center">
                            <p id="msg"></p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block js %}
    <script>
        var checked_num;
        function reset_frm() {
            $('#created_at_min').val('');
            $('#created_at_max').val('');
            $('#place_name').val('');
            $('#place_address').val('');
            {#$("#place_name")[0].selectedIndex = 0;#}
            {#$("#place_name").selectpicker('refresh');#}
            $("#company_name")[0].selectedIndex = 0;
            $("#company_name").selectpicker('refresh');
            {#$("#department_name")[0].selectedIndex = 0;#}
            {#$("#department_name").selectpicker('refresh');#}
            {#$("#user_role")[0].selectedIndex = 0;#}
            {#$("#user_role").selectpicker('refresh');#}
        }
        function reset_sel(sel_id){
        if ($("#"+ sel_id).length){
            $("#"+sel_id)[0].selectedIndex = 0;
            $("select[id='"+ sel_id +"']").selectpicker('val', '');
            $("select[id='"+ sel_id +"']").selectpicker('refresh');
        }
    }
        function resize_list_num(){
            var per_page_num = $('#per_page_num_sel').val();
            $('#per_page_num').val(per_page_num);
            var api_url = '{% url "place_management" %}';
            api_url += '?per_page_num=' + per_page_num;
            if ($('#place_name').val() != ''){
                api_url += '&place_name=' + $('#place_name').val();
            }
            if ($('#place_address').val() != ''){
                api_url += '&place_address=' + $('#place_address').val();
            }
            if ($('#created_at_min').val() != ''){
                api_url += '&created_at_min=' + $('#created_at_min').val();
            }
            if ($('#created_at_max').val() != ''){
                api_url += '&created_at_max=' + $('#created_at_max').val();
            }
            location.href=api_url;
        }
        function get_qr_img(place_id){
            $('#qr_info').html('PLACE__' + place_id);
            var qr_url = "{% url 'qr_code' 'black' 'QRDATA' %}";
            qr_url = qr_url.replace('QRDATA', 'PLACE__' + place_id);
            {#alert(qr_url);#}
            document.getElementById('qr_image').setAttribute("src", qr_url);
            {#document.getElementById('qr_image').setAttribute("alt", 'PLACE__' + place_id);#}
        }
        function open_del_place_modal(place_id) {
            $('#del_place_id').val(place_id);
        }
        function open_edit_place_modal(place_id, update_enabled, place_name, place_address, place_user, place_contact_phone){
            {#document.getElementById('edit_place_name').setAttribute('required', 'required');#}
            {#document.getElementById('add_place_name').setAttribute('required', 'required');#}
            $('#edit_place_name').val(place_name);
            if (place_address != 'None'){
                $('#edit_place_address').val(place_address);
                $('#edit_place_user').val(place_user);
                $('#edit_place_contact_phone').val(place_contact_phone);
            }else{
                $('#edit_place_address').val('');
            }
            $('#edit_place_id').val(place_id);
            if (update_enabled == 'True'){
                $('#edit_update_enabled').prop('checked', true);
            }else{
                $('#edit_update_enabled').prop('checked', false);
            }
        }
        function edit_place_modal(){
            var frm = $('#edit_place_frm');
            if (frm[0].checkValidity()){
                frm.submit();
            }else{
                frm[0].reportValidity();
            }
        }
        function open_add_place_modal(){
            document.getElementById('add_place_name').setAttribute('required', 'required');
            {#document.getElementById('add_place_name').setAttribute('required', 'required');#}
        }
        function add_place_modal(){
            var frm = $('#add_place_frm');
            if (frm[0].checkValidity()){
                frm.submit();
            }else{
                frm[0].reportValidity();
            }
        }
        function place_tract(place_name) {
            var api_url = "{% url 'place_tract' %}";
            api_url = api_url + '?place_name=' + place_name;
            {#alert(api_url);#}
            location.href = api_url;
        }
        function getCookie(cname){
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for(var i=0; i<ca.length; i++) {
                var c = ca[i].trim();
                if (c.indexOf(name)==0) { return c.substring(name.length,c.length); }
            }
            return "";
        }
        function check_place_api(pub_id) {
            var sJson = JSON.stringify
            ({
                uts: new Date().getTime(),
                place_id: pub_id
            });
            {#alert('sendding');#}
            if (window.location.port == '8003'){
                var api_url = 'http://' + window.location.hostname +':' + window.location.port + '/update_session/';
            }else{
                var api_url = window.location.protocol + '//' + window.location.hostname + '/update_session/';
            }
            $.ajax({
                type: 'POST',
                url: api_url,
                {#data: "uts="+ new Date().getTime()+"&purchase_amount="+ s_amount, // serializes the form's elements.#}
                data: sJson,
                dataType: 'json',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                    {#'Accept': 'application/vnd.ani.v1.wallet+json',#}
                    'X-MAI-TOKEN': 'DeviceUser 5c7e9f90fa2e23502cc121afed142a78d91eb81c373f9139df2d1adff4412b1d852bef3257d4192554065ff8df2331eb9ffde930915bdaaf4eb13f17aa2eeb1f',
                    'X-Client-Version': '1.0',
                    'X-Client-Id': '0M7jDJ07t-TQTn-XqV5S',
                },
                success: function(response) {
                    $.each(response, function(index, value) {
                        checked_num = value;
                        $('#print_btn').text('列印選取地點(已選取'+ checked_num +'項，最多10項)');
                    });
                },
                error: function(xhr, status, error) {
                }

            });
        }

        function check_place_cookie(pub_id) {
            if (checked_num < 10){
                check_place_api(pub_id);
            }else{
                if ($('input[id='+ 'print_place_' + pub_id + ']').prop('checked') == false){
                    check_place_api(pub_id);
                }else{
                    $('input[name='+ 'print_place_' + pub_id + ']').prop('checked', false);
                    $("#msg").text('列印一次不能選擇超過10項');
                    $("#send_notify").modal();
                }
            }

        }
        function print_place(){
            {#var check=$('input[name='+ 'print_place' + ']:checked').length;#}
            if (checked_num == 0 || checked_num == undefined){
                $("#msg").text('請至少選擇一項');
                $("#send_notify").modal();
             } else if (checked_num > 10){
                $("#msg").text('列印一次不能選擇超過10項');
                $("#send_notify").modal();
             } else {
                $('#print_frm').submit();
             }
        }
        function check_all_place_api(place_check_str) {
            var sJson = JSON.stringify
            ({
                uts: new Date().getTime(),
                all_place_id: place_check_str
            });
            {#alert('sendding');#}
            if (window.location.port == '8003'){
                var api_url = 'http://' + window.location.hostname +':' + window.location.port + '/update_session/';
            }else{
                var api_url = window.location.protocol + '//' + window.location.hostname + '/update_session/';
            }
            $.ajax({
                type: 'POST',
                url: api_url,
                {#data: "uts="+ new Date().getTime()+"&purchase_amount="+ s_amount, // serializes the form's elements.#}
                data: sJson,
                dataType: 'json',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json',
                    {#'Accept': 'application/vnd.ani.v1.wallet+json',#}
                    'X-MAI-TOKEN': 'DeviceUser 5c7e9f90fa2e23502cc121afed142a78d91eb81c373f9139df2d1adff4412b1d852bef3257d4192554065ff8df2331eb9ffde930915bdaaf4eb13f17aa2eeb1f',
                    'X-Client-Version': '1.0',
                    'X-Client-Id': '0M7jDJ07t-TQTn-XqV5S',
                },
                success: function(response) {
                    $.each(response, function(index, value) {
                        checked_num = value;
                        $('#print_btn').text('列印選取地點(已選取'+ checked_num +'項，最多10項)');
                    });
                },
                error: function(xhr, status, error) {
                }

            });
        }
        function all_checked(){
            var not_checked = 0;
            $("input[name='Checkbox[]']").each(function (){
                if($(this).prop('checked') == false){
                    not_checked += 1;
                }
            });
            if ((not_checked + checked_num) <= 10){
                var place_check_str = '';
                if($("#CheckAll").prop("checked")){
                    $("input[name='Checkbox[]']").each(function (){
                        if($(this).prop('checked') == false){
                            {#check_place_api($(this).val());#}
                            place_check_str += $(this).val() + ',';
                            $(this).prop("checked",true);
                        }
                    });
                }else{
                    $("input[name='Checkbox[]']").each(function (){
                        if($(this).prop('checked')){
                            place_check_str += $(this).val() + ',';
                            $(this).prop("checked",false);
                        }
                    });
                }
                check_all_place_api(place_check_str);
            }else{
                $("#CheckAll").prop("checked", false);
                $("#msg").text('列印一次不能選擇超過10項');
                $("#send_notify").modal();
            }
        }
        function clear_checked(){
            var api_url = '{% url "place_management" %}';
            location.href = api_url;
        }
        function open_verify_place_modal(place_pub_id, place_name, place_address, verify_place_company_name, verify_place_user, verify_place_contact_phone){

            $('#verify_place_pub_id').val(place_pub_id);
            $('#verify_place_name').val(place_name);
            if (place_address == 'None'){
                place_address = '';
            }
            $('#verify_place_address').val(place_address);

            {#$("select[id='verify_company_id']").selectpicker('val', place_company_id);#}
            {#$("select[id='verify_company_id']").selectpicker('refresh');#}
            $('#verify_place_company_name').val(verify_place_company_name);

            if (verify_place_user == 'None'){
                verify_place_user = '';
            }
            $('#verify_place_user').val(verify_place_user);
            if (verify_place_contact_phone == 'None'){
                verify_place_contact_phone = '';
            }
            $('#verify_place_phone').val(verify_place_contact_phone);
        }
        function verify_place_submit(verify_status){
            $('#verify_status').val(verify_status);
            if (verify_status == 'YES'){
                if ($('#verify_place_frm')[0].checkValidity()){
                    $('#verify_place_frm').submit();
                }else{
                    $('#verify_place_frm')[0].reportValidity();
                }

            }else{
                $('#verify_place_frm').submit()
            }
        }
        $(document).ready(function() {
            $('#datetimepicker_min').datetimepicker({
                format: 'YYYY-MM-DD HH:mm',
                locale: 'zh-cn'
            });
            $('#datetimepicker_max').datetimepicker({
            format: 'YYYY-MM-DD HH:mm',
                locale: 'zh-cn',
                useCurrent: false
            });
            $("#datetimepicker_min").on("dp.change", function (e) {
                $('#datetimepicker_max').data("DateTimePicker").minDate(e.date);
            });
            $("#datetimepicker_max").on("dp.change", function (e) {
                $('#datetimepicker_min').data("DateTimePicker").maxDate(e.date);
            });
            if (checked_num == undefined){
                if ('{{ request.session.check_place_num }}' == '' || '{{ request.session.check_place_num }}' == undefined){
                    checked_num = 0;
                    $('#print_btn').text('列印選取地點(已選取0項，最多10項)');
                }else{
                    checked_num = parseInt('{{ request.session.check_place_num }}');
                    $('#print_btn').text('列印選取地點(已選取'+ checked_num +'項，最多10項)');
                }
            }
            var not_checked = 0, already_checked = 0;
            $("input[name='Checkbox[]']").each(function (){
                if($(this).prop('checked') == false){
                    not_checked += 1;
                }else{
                    already_checked += 1
                }
            });
            if (not_checked == 0){
                $('#print_btn').text('列印選取地點(已選取'+ already_checked +'項，最多10項)');
                if ($("input[name='Checkbox[]']").length != 0){
                    $("#CheckAll").prop("checked", true);
                }else{
                    $("#CheckAll").prop("checked", false);
                }
            }

        });
    </script>
{% endblock %}