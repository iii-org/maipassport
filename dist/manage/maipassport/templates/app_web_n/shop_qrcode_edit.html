{#{% extends 'app_web_n/base.html' %}#}
{% load static %}
{% load i18n %}
{#{% block content %}#}
<!doctype html>
<html lang="en" class="deeppurple-theme">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="Maxartkiller">

    <title>{% trans 'Shop Registration' %}</title>

    <!-- Material design icons CSS -->
    <link rel="stylesheet" href="{% static 'app_web/vendor/materializeicon/material-icons.css' %}">

    <!-- Roboto fonts CSS -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="{% static 'app_web/vendor/bootstrap-4.4.1/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Swiper CSS -->
    <link href="{% static 'app_web/vendor/swiper/css/swiper.min.css' %}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{% static 'app_web/css/style.css' %}" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'backend/fontawesome-free-5.3.1-web/css/all.css' %}">

    <style>
        .row {
            margin-right: 1px;
        }

        .crop img {
            width: 80px;
            height: 100px;
            margin: -25px 0 0 -10px;
        }

        {# 深色模式 logo #}
        .theme-dark .header-logo {
            /*content: url('../img/logo-header-white.png');*/
            {#content: url({% static 'app_web/img/logo-04a.png' %});#}
            {% if request.session.iii_login %}
                content: url({% static 'app_web/img/main_logo_white.png' %});
            {% else %}
                content: url({% static 'app_web/img/logo-04a.png' %});
            {% endif %}
        }

        .theme-dark .logo-small {
            /*content: url('../img/logo-login-white.png');*/
            {% if request.session.iii_login %}
                content: url({% static 'app_web/img/main_logo_white.png' %});
            {% else %}
                content: url({% static 'app_web/img/logo-04a.png' %});
            {% endif %}
        }
        .logo-small {
            /*content: url('../img/logo-login-white.png');*/
            {% if not request.session.iii_login %}
                width: 250px;
            {% endif %}
        }
        {#.ix_bar{}#}
    </style>
    {% block stylesheet %}{% endblock %}
    <style>
        /* iPhone X and Xs Max */
        @media only screen
            and (min-device-width: 375px)
            and (min-device-height: 812px)
            and (-webkit-device-pixel-ratio: 3)
            and (orientation: portrait) {
                /* styles */

                .header {
                    height: env(safe-area-inset-top);
                    padding: env(safe-area-inset-top);
                }

                .contentinfo{
                    /*padding: 44px 3% 0 3%;*/
                    padding: env(safe-area-inset-top) 3% 0 3%;
                }
                .ix_bar{
                    height: 30px;
                }
                .header .btn {
                    text-align: left;
                    width: 30px;
                }
            }

        /* iPhone XR */
        @media only screen
            and (min-device-width: 414px)
            and (min-device-height: 896px)
            and (-webkit-device-pixel-ratio: 2)
            and (orientation: portrait) {
                /* styles */

                .header {
                    height: env(safe-area-inset-top);
                    padding: env(safe-area-inset-top);
                }

                .contentinfo{
                    padding: env(safe-area-inset-top) 3% 0 3%;
                }
                .ix_bar{
                    height: 30px;
                }
                .header .btn {
                    text-align: left;
                    width: 30px;
                }
            }
    </style>
</head>
<body>
<!-- Loader -->
<div class="row no-gutters vh-100 bg-template loader-screen " id="loader_page">
    <div class="col align-self-center text-center">
        {#            <img src="{% static 'app_web/img/main_logo_white.png' %}" alt="logo" class="logo-small">#}
        {#            <img src="{% static 'app_web/img/logo-04a.png' %}" alt="logo" class="logo-small">#}
        {% if request.session.iii_login %}
            <img src="{% static 'app_web/img/main_logo_white.png' %}" alt="logo" class="logo-small">
        {% else %}
            <img src="{% static 'app_web/img/logo-04a.png' %}" alt="logo" class="logo-small">
        {% endif %}
        {#            <h1 class="mt-3"><span class="font-weight-light ">我的</span>通行碼</h1>#}
        <h1 class="mt-3">{% trans 'MY PASSCODE' %}</h1>

        <div class="laoderhorizontal">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
    <!-- Loader ends -->

<div class="wrapper" id="wrapper_base">
    <div class="row" id="header_bar" style="padding-top: 5px;">
        <div class="col text-center">
            {% if request.session.iii_login %}
                <a href="{% url 'app_index' request.app_user.pub_id request.app_user.api_token %}">
                    <img src="{% static 'app_web/img/main_logo.png' %}" alt="" class="header-logo" style="margin-left: -15px;">
                </a>
            {% else %}
                <a href="{% url 'app_index' request.app_user.pub_id request.app_user.api_token %}">
                    <img src="{% static 'app_web/img/logo-04b.png' %}" alt="" class="header-logo" style="width: 190px;max-height: 65px;">
                </a>
            {% endif %}
        </div>
    </div>
    <div style="height: 50px;"></div>
    <div class="row">
        <div class="container">
            <div class="row" style="padding-left: 30px;">
                <div class="col-12" style="padding-left: 0;padding-right: 0;">
                    <div class="card shadow-sm border-0 mb-3 wizard">
                        <div class="card-header p-0">
{#                            <ul class="nav nav-tabs tabs-md nav-justified" role="tablist">#}
{#                                <li role="presentation" class="nav-item">#}
{#                                    <a href="#step13" class="nav-link border-primary active" data-toggle="tab" aria-controls="step13" role="tab" title="Step 1" id="step13_a">#}
{#                                        <i class="material-icons">assignment</i>#}
{#                                        {% trans 'Shop Registration' %}#}
{#                                    </a>#}
{#                                </li>#}
{#                                <li role="presentation" class="nav-item">#}
{#                                    <a href="#step23" class="nav-link border-primary" data-toggle="tab" aria-controls="step23" role="tab" title="Step 2" id="step23_a">#}
{#                                        <i class="material-icons">assignment_turned_in</i>#}
{#                                        {% trans 'Location List' %}#}
{#                                    </a>#}
{#                                </li>#}
{#                            </ul>#}
                        </div>
{#                        <a onclick="approach_record()"></a>#}
                        <div class="card-body">
                            <div class="tab-content">
                                <div class="tab-pane active" role="tabpanel" id="step13">
{#                                    <h6 class="subtitle" style="padding-left: 15px;">{% trans 'Company / School Registration' %}</h6>#}
                                    <div class="col-12 px-0">
                                        <div style="height: 30px;"></div>
                                        <div id="step1_a_div" class="text-center">
                                            <form method="post" action="{% url 'shop_qrcode_edit' request.app_user.pub_id request.app_user.api_token %}">
                                            {% csrf_token %}
                                                <input type="hidden" value="{{ shop_pub_id }}" name="shop_pub_id">
                                                <div class="row bottom40">
                                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                                        <div class="form-group float-label active" >
                                                            <input type="text" class="form-control text-template" id="id_username" name="app_user" style="font-size: 18px;" value="{{ place_user }}" readonly>
                                                            <label class="form-control-label " style="font-size: 18px;">{% trans 'Applicant' %}</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row bottom40">
                                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                                        <div class="form-group float-label active" >
                                                            <input type="text" class="form-control text-template" id="id_username" style="font-size: 18px;" value="{{ place_user_phone }}" readonly>
                                                            <label class="form-control-label " style="font-size: 18px;">{% trans 'Applicant Phone' %}</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row bottom40">
                                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                                        <div class="form-group float-label active" >
                                                            <input type="text" class="form-control text-template" name="shop_name" style="font-size: 18px;" value="{{ shop_name }}">
                                                            <label class="form-control-label " style="font-size: 18px;">{% trans 'Shop / Location Name' %}</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row bottom40">
                                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                                        <div class="form-group float-label active" >
                                                            <input type="text" class="form-control text-template" name="shop_address" style="font-size: 18px;" value="{{ shop_address }}">
                                                            <label class="form-control-label " style="font-size: 18px;">{% trans 'Shop / Location Address' %}</label>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row bottom40">
                                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                                        <div class="form-group float-label active" >
                                                            <input type="text" class="form-control text-template" name="shop_phone" style="font-size: 18px;" value="{{ shop_phone }}" >
                                                            <label class="form-control-label " style="font-size: 18px;">{% trans 'Shop / Location Phone' %}</label>
                                                        </div>
                                                    </div>
                                                </div>
{#                                                <div class="row bottom40">#}
{#                                                    <div class="col-md-12 col-sm-12 col-xs-12">#}
{#                                                        <div class="form-group float-label active">#}
{#                                                            <input type="text" class="form-control text-template" name="register_code" style="font-size: 18px;">#}
{#                                                            <label class="form-control-label" style="font-size: 18px;">{% trans 'Register Code' %}</label>#}
{#                                                        </div>#}
{#                                                    </div>#}
{#                                                </div>#}
                                                <div style="height: 50px;"></div>
                                                <div class="row bottom40">
                                                    <div class="col-md-12 col-sm-12 col-xs-12">
                                                        <button type="submit" class="btn btn-lg btn-default text-white btn-block btn-rounded shadow" id="btn_send"><span>{% trans 'Submit' %}</span></button>
                                                    </div>
                                                </div>
                                                <div style="height: 20px;"></div>
                                                <div class="row bottom40">
                                                    <div class="col-md-12 col-sm-12 col-xs-12">
{#                                                        <a onclick="liff.closeWindow()"  class="btn btn-lg btn-default text-white btn-block btn-rounded shadow" style="background-color: #848181;"><span>{% trans 'Back' %}</span></a>#}
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="tab-pane" role="tabpanel" id="step23">
{#                                    <h6 class="subtitle" style="padding-left: 15px;">{% trans 'Registration List' %}</h6>#}
                                    <div class="col-12 px-0">
                                        <ul class="list-group list-group-flush border-top border-bottom" id="step2_div">
{#                                            <li style="list-style: none">#}
{#                                                <div class="wrapper" id="wrapper_base">#}
{#                                                    <div class="col-md-8 col-sm-8 col-xs-8" style="text-align: left; float: left; font-size: 18px">shop_name</div>#}
{#                                                    <div class="col-md-4 col-sm-4 col-xs-4" style="float:right">#}
{#                                                        <button class="btn btn-danger" style="float: right">Qrcode</button>#}
{#                                                    </div>#}
{#                                                    <div class="col-md-8 col-sm-8 col-xs-8" style="text-align: left; float: left; font-size: 18px">Company_name</div>#}
{#                                                    <div class="col-md-4 col-sm-4 col-xs-4" style="float:right">#}
{#                                                        <button class="btn btn-default" style="float: right">Modify</button>#}
{#                                                    </div>#}
{#                                                    <div class="col-md-8 col-sm-8 col-xs-8" style="font-size: 18px; float: left">timestamp</div>#}
{#                                                <div class="clearfix"></div>#}
{#                                                </div>#}
{#                                            </li>#}
                                        </ul>
                                        <div style="height: 30px;"></div>
                                        <div id="step2_a_div" class="text-center"></div>
                                        <div class="text-center">
                                            <div style="height: 20px;"></div>
                                            <div class="row bottom40">
                                                <div class="col-md-12 col-sm-12 col-xs-12">
{#                                                    <a onclick="liff.closeWindow()"  class="btn btn-lg btn-default text-white btn-block btn-rounded shadow" style="background-color: #848181;"><span>{% trans 'Back' %}</span></a>#}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- message modal -->
<div class="modal fade" id="message_modal" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title text-template" id="exampleModalLabel">{% trans 'Message' %}</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="msg" class="text-template"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">{% trans 'Close' %}</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="cancel_apply_modal" tabindex="-1" role="dialog" aria-labelledby="ModalCenterTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h6 class="modal-title text-template" id="exampleModalLabel">{% trans 'Message' %}</h6>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="text-template">{% trans 'Are you sure you want to cancel?' %}</p>
            </div>
            <div class="modal-footer">
                    <button type="submit" class="btn btn-danger">{% trans 'Submit' %}</button>
            </div>

        </div>
    </div>
</div>
<!-- model end -->
<script src="{% static 'app_web/js/jquery-3.3.1.min.js' %}"></script>
<script src="{% static 'app_web/js/popper.min.js' %}"></script>
<script src="{% static 'app_web/vendor/bootstrap-4.4.1/js/bootstrap.min.js' %}"></script>

<!-- swiper js -->
<script src="{% static 'app_web/vendor/swiper/js/swiper.min.js' %}"></script>

<!-- cookie js -->
<script src="{% static 'app_web/vendor/cookie/jquery.cookie.js' %}"></script>

<!-- template custom js -->
<script src="{% static 'app_web/js/main.js' %}"></script>
<script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

<script>
    var server_url;
    function shop_reg_record(next_url){
            var record_list, next_link, api_url, html_str;
            {#var sJson = JSON.stringify({record_type: 'APPROACH', uts: new Date().getTime(),});#}
            if (next_url == 'default'){
                {#if (window.location.port == '8003'){#}
                {#    api_url = 'http://' + window.location.hostname +':' + window.location.port + '/web-user-records/';#}
                {# }else{#}
                {#    api_url = window.location.protocol + '//' + window.location.host + '/web-user-records/';}#}
                api_url = server_url + '/web-user-records/';
            }else{
                api_url = next_url;
            }
            {#alert(api_url);#}
            $.ajax({
                type: 'get',
                url: api_url,
                data: {"record_type": 'SHOP_REG', "uts": new Date().getTime()},
                headers: {
                    'Content-Type': 'application/json',
                    {#'Accept': 'application/vnd.ani.v1.wallet+json',#}
                    'X-MAI-TOKEN': 'WebUser ' + '{{ request.app_user.api_token }}',
                    {#'X-Client-Version': '1.0',#}
                    'X-Client-Id': '{{ request.app_user.pub_id }}',
                },
                success: function(response) {
                    {#alert(response);#}
                    $.each(response, function(index, value) {
                        if (index == 'results'){
                            record_list = value;
                            if (value == ''){
                                document.getElementById('step2_div').style.display = "none";
                                document.getElementById('step2_a_div').style.display = "";
                                document.getElementById('step2_a_div').innerHTML = '尚無申請';
                            }
                        }
                        if (index == 'next'){
                            if (value != null){
                                value = value.replace('http://web', server_url);
                                document.getElementById('step2_a_div').style.display = "";
                                document.getElementById('step2_a_div').innerHTML = '<a onclick="shop_reg_record(\'' + value +  '\')">' + "{% trans 'More'  %}" + '</a>';
                            }else{
                                document.getElementById('step2_a_div').style.display = "none";
                            }

                        }
                    });

                    for (var i in record_list){
                        html_str = '';
                        html_str += '<li class="list-group-item"><div class="row align-items-center"><div class="col align-self-center pr-0"><h6 class="font-weight-normal mb-1">' +
                            record_list[i]['shop_name'] + ' / ' + record_list[i]['shop_phone'] + '</h6><h6 class="font-weight-normal mb-1">' +
                            record_list[i]['shop_address'] + '</h6><p class="text-mute small text-secondary">' + record_list[i]['record_time'] + '</p></div><div class="col-auto">';

                        if (record_list[i]['status'] == '0' || record_list[i]['status'] == '2'){
                            html_str += '<h6 class="font-weight-normal mb-1 text-right" style="color: orangered">' + record_list[i]['status_show'] + '</h6>';
                            html_str += '<a onclick="cancel_apply(\''+ record_list[i]['pub_id']  + '\')" data-toggle="modal" data-target="#cancel_apply_modal" style="cursor: pointer; float: right;">'+ '{% trans "Cancel Apply" %}' +'</a>'
                        }else if(record_list[i]['status'] == '1') {
                            html_str += '<h6 class="text-success text-right">' + record_list[i]['status_show'] + '</h6>';
                            html_str += '<a style="cursor: pointer; float: right;">' + '{% trans "Show Qrcode" %}' + '</a><br>';
                            html_str += '<a style="cursor: pointer; float: right;">' + '{% trans "Edit" %}' + '</a>';
                        }else{
                            html_str += '<h6 class="text-danger text-right">' + record_list[i]['status_show'] + '</h6>';
                        }
                        html_str += '</div></div></li>';
                        document.getElementById('step2_div').innerHTML += html_str;
                    }

                },
                error: function(xhr, status, error) {

                    {#alert(xhr.responseText);#}
                    {#var error_result = JSON.parse(xhr.responseText);#}
                    {#alert(error_result[1]);#}
                    {#alert(typeof(error_result.errors.phone[0].code));#}
                    {#alert(error_result.errors.phone[0].message);#}


                }
            });
        }
    function cancel_apply(apply_id){
        $('#apply_id').val(apply_id);
    }

    $(document).ready(function(){
        if (window.location.port == '8003'){
            server_url = 'http://' + window.location.hostname +':' + window.location.port;
        }else{
            server_url = window.location.protocol + '//' + window.location.host + window.location.port;
        }
        shop_reg_record('default');
        document.getElementById('sidebar').style.display = "";
        document.getElementById('hamburger').style.display = "";
        if ('{{ show_list }}' != ''){
            $("#step13").removeClass('active');
            document.getElementById("step23").setAttribute("class", "tab-pane active")

            $("#step13_a").removeClass('active');
            document.getElementById("step23_a").setAttribute("class", "nav-link border-primary active")
        }


        if ('{{ message }}'){
            $("#msg").text('{{ message }}');
            $("#message_modal").modal();
        }
     });




</script>

</body>

</html>
{#{% endblock %}#}