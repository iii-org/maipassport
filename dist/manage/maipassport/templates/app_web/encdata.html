{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>enc Test</title>
</head>
<body>

<label>user_name</label>
<input type="text" id="user_name" value="170910">
<label>timestamp</label>
<input type="text" id="timestamp" >
<button onclick="enc()">enc</button>
<div style="height: 10px;"></div>
<label>enc data</label>
<input type="text" id="enc_data_input" readonly style="width: 500px;"><br>
<a id="enc_data"></a>

</body>
<script type="text/javascript" src="{% static 'app_web/js/CryptoJSv3/rollups/aes.js' %}"></script>
    <script type="text/javascript" src="{% static 'app_web/js/CryptoJSv3/components/pad-zeropadding.js' %}"></script>
    <script type="text/javascript">
        function enc() {
            {#var encrypted =  decodeURIComponent("5P%2F6Rae8NgkiTRtXuthz3gAJLjaG9Ay56XueE0GuwTk%3D");#}
            var content_user_name = document.getElementById('user_name').value;
            var content_timestamp = document.getElementById('timestamp').value;
            {#var content = CryptoJS.enc.Utf8.parse('170910\t 20200428202900');#}
            var content_input = content_user_name + '\t' + content_timestamp;
            {#alert(content_input);#}
            var content = CryptoJS.enc.Utf8.parse(content_input);
            var iv_source = CryptoJS.enc.Utf8.parse("RkqtoDYkOi2NS&xK");

            var key = CryptoJS.enc.Utf8.parse("<`m<*@|]L8ZUG4kxV(%&9S2WQ}_KPMs9");

            {#alert('iv='+iv_source+', key='+key+',encrypted='+ encrypted);#}


            var encrypted = CryptoJS.AES.encrypt(content, key, {
                iv: iv_source,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.ZeroPadding});
            {#alert(encodeURIComponent(encrypted.toString()));#}
            document.getElementById('enc_data_input').value = encodeURIComponent(encrypted.toString());
            if (window.location.port == '8003'){
                {#alert(window.location.port);#}
                document.getElementById('enc_data').innerText = window.location.protocol + '//' + window.location.hostname  + ':8003/app/login_new/?token=' + encodeURIComponent(encrypted.toString());
                document.getElementById('enc_data').href = window.location.protocol + '//' + window.location.hostname + ':8003/app/login_new/?token=' + encodeURIComponent(encrypted.toString());
            }else{
                document.getElementById('enc_data').innerText = window.location.protocol + '//' + window.location.hostname  + '/app/login_new/?token=' + encodeURIComponent(encrypted.toString());
                document.getElementById('enc_data').href = window.location.protocol + '//' + window.location.hostname + '/app/login_new/?token=' + encodeURIComponent(encrypted.toString());
            }



        }
        var iv_source = CryptoJS.enc.Utf8.parse("RkqtoDYkOi2NS&xK");
        var key = CryptoJS.enc.Utf8.parse("<`m<*@|]L8ZUG4kxV(%&9S2WQ}_KPMs9");
        var enc1 = decodeURIComponent("g1AyVbA3VcyDn9T3daB4sYT9DT7JE/64uQuPrpqGalA=");
        {#var enc1 = '_uTI21yqA2H5mJwkP89Yv803JEyFEbrRcy_UivLZHOo=';#}
        {#alert(enc1);#}
        var decrypted = CryptoJS.AES.decrypt(enc1, key, {
            iv: iv_source,
            mode: CryptoJS.mode.CBC,
            padding: CryptoJS.pad.ZeroPadding});
        {#alert('d='+decrypted);#}
        decrypted = CryptoJS.enc.Utf8.stringify(decrypted);//轉為UTF8字串
        {#alert('d2='+decrypted);#}
    </script>
</html>