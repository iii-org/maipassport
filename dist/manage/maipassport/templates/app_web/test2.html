{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Chat Room</title>
</head>
<body>
    <textarea id="chat-log" cols="100" rows="20"></textarea><br/>
    <input id="chat-message-input" type="text" size="100"/><br/>
    <input id="chat-message-submit" type="button" value="Send"/>
</body>
<script src="{% static 'app_web/js/jquery-3.3.1.min.js' %}"></script>
<script src="{% static 'app_web/js/popper.min.js' %}"></script>
<script src="{% static 'app_web/vendor/bootstrap-4.4.1/js/bootstrap.min.js' %}"></script>
<script>
    {#var roomName = {{ room_name_json }};#}
    var ws_url;
    if (window.location.port == 8003){
        ws_url = 'ws://' + window.location.hostname + ':' + window.location.port + '/qr/trans/' + {{ room_name_json }} + '/';
    }else{
        {#if (window.location.protocol == 'https:'){#}
        {#    ws_url = 'wss://' + window.location.host + '/qr/trans/' + {{ room_name_json }} + '/';#}
        {# }else{#}
        {#    ws_url = 'ws://' + window.location.host + '/qr/trans/' + {{ room_name_json }} + '/';#}
        {# }#}
        ws_url = 'ws://' + window.location.host + '/qr/trans/' + {{ room_name_json }} + '/';
    }

    var chatSocket = new WebSocket(ws_url);

    chatSocket.onmessage = function(e) {
        var data = JSON.parse(e.data);
        var message = data['message'];
        {#alert(message);#}
        document.querySelector('#chat-log').value += (message + '\n');
        console.log('message:'+message)
    };

    chatSocket.onclose = function(e) {
        console.error('Chat socket closed unexpectedly');
        console.log('close:')
    };

    document.querySelector('#chat-message-input').focus();
    document.querySelector('#chat-message-input').onkeyup = function(e) {
        if (e.keyCode === 13) {  // enter, return
            document.querySelector('#chat-message-submit').click();
        }
    };

    document.querySelector('#chat-message-submit').onclick = function(e) {
        var messageInputDom = document.querySelector('#chat-message-input');
        var message = messageInputDom.value;
        chatSocket.send(JSON.stringify({
            'message': message
        }));
        console.log('send:');

        messageInputDom.value = '';
    };
    {#$(document).ready(function() {#}
    {##}
    {#    alert(1);#}
    {#    chatSocket.send(JSON.stringify({#}
    {#        'message': 'test11111'#}
    {#    }));#}
    {#    alert(2);#}
    {# });#}
</script>
</html>