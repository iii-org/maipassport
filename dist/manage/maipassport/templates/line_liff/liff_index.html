<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Test</title>
</head>

<body>
    <form action="">
        <div id="OS"></div>
        <div id="Language"></div>
        <div id="Version"></div>
        <div id="isInClient"></div>
        <div id="isLoggedIn"></div>
        <div id="idToken"></div>
        <div id="userId"></div>
        <div id="displayName"></div>
        <div id="pictureUrl"></div>

        <hr>
        <button type="button" id="scanQrCodeButton" onclick="scanQR()">Open QR Code Reader</button>

{#        <div id="scanQr" class="hidden textLeft">#}
{#            <h2>QR Code reader</h2>#}
{#            <a href="#" onclick="toggleQrCodeReader()">Close QR Code Reader Result</a>#}
{#            <table>#}
{#                <tr>#}
{#                    <th>scanCode Result</th>#}
{#                    <td id="scanQrField"></td>#}
{#                </tr>#}
{#            </table>#}
{#        </div>#}
    </form>
    <hr>
    <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
    <script>
        function initializeLiff(myLiffId) {
            liff.init({
                    liffId: myLiffId
                })
                .then(() => {
                    // start to use LIFF's api
                    {#initializeApp();#}
                    document.getElementById('OS').innerHTML = liff.getOS();
                    document.getElementById('Language').innerHTML = liff.getLanguage();
                    document.getElementById('Version').innerHTML = liff.getVersion();
                    document.getElementById('isInClient').innerHTML = liff.isInClient();
                    document.getElementById('isLoggedIn').innerHTML = liff.isLoggedIn();

                    {#if (!liff.isLoggedIn()) {#}
                    {#    liff.login({ redirectUri: "https://201d0dd965e1.ngrok.io/line/" });#}
                    {# }#}

                    document.getElementById('idToken').innerHTML =  liff.getIDToken();
                    liff.getProfile()
                        .then(profile => {
                            document.getElementById('userId').innerHTML =  profile.userId;
                            document.getElementById('displayName').innerHTML =  profile.displayName;
                            document.getElementById('pictureUrl').innerHTML =  profile.pictureUrl;

                        })
                        .catch((err) => {
                            alert(err);
                        });
                    document.getElementById('idToken').innerHTML =  liff.getIDToken();

                })
                .catch((err) => {
                });
        }

        initializeLiff('1654867456-Xk542PWV');

        function sendAlertIfNotInClient() {
            alert('This button is unavailable as LIFF is currently being opened in an external browser.');
        }

        {#document.getElementById('scanQrCodeButton').addEventListener('click', function() {#}
        function scanQR() {
            alert(0);
            if (!liff.isInClient()) {
                sendAlertIfNotInClient();
            } else {
                alert('start');
                alert(liff.scanCode);
                if (liff.scanCode){
                    liff.scanCode().then(result => {
                        alert('success');
                    }).catch(err => {
                        document.getElementById('scanQrField').textContent = "scanCode failed!";
                        alert('catch failed');
                    });
                    alert('end');
                }else{
                    alert('open failed');
                }
                alert('all done');
            }
         }

        {#function postData(url, data) {#}
        {#    return fetch(url, {#}
        {#        body: JSON.stringify(data),#}
        {#        cache: 'no-cache',#}
        {#        headers: {#}
        {#            'user-agent': 'Mozilla/4.0 MDN Example',#}
        {#            'content-type': 'application/json'#}
        {#        },#}
        {#        method: 'POST',#}
        {#        mode: 'cors',#}
        {#    })#}
        {#        .then(response => response.json()) // 輸出成 json#}
        {# }#}
        {##}
        {##}
        {#document.getElementById('submit-btn').addEventListener('click', function () {#}
        {#    if (!liff.isInClient()) {#}
        {#        sendAlertIfNotInClient();#}
        {#    } else {#}
        {#        const twdInput = parseInt(document.getElementById('twd-input').value);#}
        {#        postData('https://b80d3d893891.ngrok.io/line/currency_exchange/', { twd: twdInput })#}
        {#            .then(data => {#}
        {#                alert('1', data);#}
        {#                alert('1');#}
        {#                liff.sendMessages([{#}
        {#                    'type': 'text',#}
        {#                    'text': "你有這麼多美金：" + data['result']#}
        {#                }]).then(function () {#}
        {#                    window.alert('Message sent');#}
        {#                }).catch(function (error) {#}
        {#                    window.alert('Error sending message: ' + error);#}
        {#                });#}
        {#                liff.closeWindow();#}
        {#            }) // JSON from `response.json()` call#}
        {#            .catch(error => alert(error))#}
        {#    }#}
        {# });#}
    </script>
</body>

</html>