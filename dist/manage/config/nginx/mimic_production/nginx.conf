upstream web {
  ip_hash;
  server web:8000;
}
server {
    server_tokens off;
    listen 8080;
    location /health-status {
        access_log off;
        return 200;
    }
}

# portal
server {
  listen 80;
  server_name localhost;

  client_max_body_size 10m;

  proxy_read_timeout 100s;
  proxy_send_timeout 100s;

  location / {
    proxy_pass http://web/;
  }

  location /ws/ {
    proxy_pass http://0.0.0.0:80;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    proxy_redirect off;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Host $server_name;
  }

  location /static/ {
    alias /staticfiles/;
  }

  client_header_timeout 15s;
  client_body_timeout 30s;
  keepalive_timeout 45s;

  location /app/ {
    # allow 61.31.168.207;
    # deny  all;

    proxy_pass http://web/app/;
  }

  location /passboard/ {
    # allow 61.31.168.207;
    # deny  all;

    proxy_pass http://web/passboard/;
  }

  location /mai_secret_garden/ {
    allow 61.31.168.207;
    deny  all;

    proxy_pass http://web/mai_secret_garden/;
  }


}
