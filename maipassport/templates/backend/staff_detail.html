{% extends 'backend/base.html' %}
{% load static %}
{% load utils %}
{% block stylesheet %}{% endblock %}
{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-md-10 col-sm-10 col-xs-10 bread-sec">
                <a href="{% url 'company_index' request.session.company_manage_id_sel_now %}" style="color:#868686;text-decoration: none;"> 首頁 </a>><a style="color:#868686;text-decoration: none;"> 系統管理 </a>><a href="{% url 'staff_management' request.session.company_manage_id_sel_now %}" style="color:#868686;text-decoration: none;"> 員工管理 </a>><a style="color:#868686;text-decoration: none;"> 員工資訊 </a>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12 " style="margin: 20px 0 20px 0px;font-size:25px; "> 員工資訊 <img src="{% static 'backend/images/LINE.png' %}" class="img-responsive top5" alt="" /> </div>
        </div>
    </div>
    <div class="container" >
        <!-- Main -->
        <ul class="nav nav-tabs" id="myTab">
            <li class="active"><a data-toggle="tab" href="#profile">員工資料</a></li>
{#            <li><a data-toggle="tab" href="#clock_in">簽進簽出紀錄</a></li>#}
            <li><a data-toggle="tab" href="#approach">接觸紀錄</a></li>
            <li><a data-toggle="tab" href="#place">地點紀錄</a></li>
        </ul>
        <div class="tab-content">
            <div id="profile" class="tab-pane fade in active">
                <div class="row bottom40" >
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div style="font-size: 15px;padding:45px 0 15px;">
                            <div class="col-lg-offset-1 col-lg-10 col-xs-12">
{#                                <form class="form-horizontal" method="post" action="{% url 'staff_detail' request.session.company_manage_id_sel_now app_user.pub_id %}">#}
                                <form class="form-horizontal">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label for="exampleInputPassword1" class="col-md-1 control-label">員工名稱 </label>
                                        <div class="col-md-5">
                                            <input type="text" class="form-control" placeholder="" readonly value="{{ app_user.auth_user.first_name }}">
                                        </div>
{#                                        <label for="exampleInputPassword1" class="col-md-1 control-label">部門 </label>#}
{#                                        <div class="col-md-5">#}
{#                                            <input type="text" class="form-control" placeholder="" readonly value="{{ app_user.department.name }}">#}
{#                                        </div>#}
                                    </div>
                                    <div class="form-group">
                                        <label for="exampleInputPassword1" class="col-md-1 control-label">電話 </label>
                                        <div class="col-md-5">
                                            <input type="text" class="form-control" placeholder="" readonly {% if app_user.phone %}value="{{ app_user.phone }}"{% endif %}>
                                        </div>
                                        <label for="exampleInputPassword1" class="col-md-1 control-label">電子郵件 </label>
                                        <div class="col-md-5">
                                            <input type="text" class="form-control" placeholder="" readonly {% if app_user.email %}value="{{ app_user.email }}"{% endif %}>
                                        </div>
                                    </div>
                                    <div class="form-group">
{#                                        <label for="exampleInputPassword1" class="col-md-1 control-label">目前上班狀態 </label>#}
{#                                        <div class="col-md-5">#}
{#                                            <input type="text" class="form-control" placeholder="" readonly value="{{ work_status }}">#}
{#                                        </div>#}
                                        <label for="exampleInputPassword1" class="col-md-1 control-label">目前健康碼 </label>
                                        <div class="col-md-5">
                                            <input type="text" class="form-control" placeholder="" readonly value="{{ health_code }}">
                                        </div>
                                    </div>

{#                                    <div class="form-group">#}
{#                                        <label for="exampleInputPassword1" class="col-md-1 control-label">管理權限 </label>#}
{#                                        <div class="col-md-5">#}
{#                                            <input type="text" class="form-control" readonly {% if app_user.manage_enabled %}value="有"{% else %}value="否"{% endif %}>#}
{#                                        </div>#}
{#                                        <label for="exampleInputPassword1" class="col-md-1 control-label">健康碼更新權限 </label>#}
{#                                        <div class="col-md-5">#}
{#                                            <input type="text" class="form-control" readonly {% if scan_enabled %}value="有"{% else %}value="否"{% endif %}>#}
{#                                            <select class="selectpicker form-control" name="scan_enabled_edit">#}
{#                                                <option {% if app_user.scan_enabled %}selected{% endif %} value="1">是</option>#}
{#                                                <option {% if not app_user.scan_enabled %}selected{% endif %} value="0">否</option>#}
{#                                            </select>#}
{#                                        </div>#}
{#                                    </div>#}
{#                                    <div class="form-group">#}
{#                                        <label for="exampleInputPassword1" class="col-md-1 control-label">後台管理者 </label>#}
{#                                        <div class="col-md-5">#}
{#                                            <input type="checkbox" class="form-control" {% if admin_flag %}checked{% endif %} name="admin_flag_checkbox">#}
{#                                        </div>#}
{#                                    </div>#}
{#                                    <div class="col-md-12 text-right">#}
{#                                        <button type="submit" class="btn btn-default " style="background:#1f74a3;color:#fff">修改</button>#}
{#                                    </div>#}
                                    {% if user_company_list %}
                                        <div class="col-md-12" style="border-bottom:1px dashed #898989; height: 15px;"></div>
                                        <div style="height: 70px;"></div>
                                        <table class="table table-striped table-bordered" >
                                            <tr>
                                                <th class="text-center cen_blue">部門</th>
{#                                                <th class="text-center cen_blue">職稱</th>#}
                                                <th class="text-center cen_blue">在職</th>
                                                <th class="text-center cen_blue">管理權限</th>
                                                <th class="text-center cen_blue">掃描權限</th>
{#                                                <th class="text-center cen_blue">修改管理權限</th>#}
                                            </tr>
                                            {% for user_company in user_company_list %}
                                                <tr>
{#                                                    <td class="cen text-center">{{ user_company.company.name  }}</td>#}
                                                    <td class="cen text-center">{{ user_company.department.name  }}</td>
{#                                                    <td class="cen text-center">{{ user_company.title.name  }}</td>#}
                                                    <td class="cen text-center" >
                                                        {% if user_company.employed %}是{% else %}否{% endif %}
{#                                                        <a href="#"><i class="fas fa-edit"></i></a>#}
                                                    </td>
                                                    <td class="cen text-center" >
                                                         {% if user_company.manage_enabled %}是{% else %}否{% endif %}
                                                    </td>
                                                    <td class="cen text-center" >
                                                        {% if user_company.scan_enabled %}
                                                            是
                                                            <a href="{% url 'edit_staff_scan_enable' request.session.company_manage_id_sel_now user_company.pub_id '0' 'DETAIL' %}"><i class="fas fa-edit"></i></a>
                                                        {% else %}
                                                            否
                                                            <a href="{% url 'edit_staff_scan_enable' request.session.company_manage_id_sel_now user_company.pub_id '1' 'DETAIL' %}"><i class="fas fa-edit"></i></a>
                                                        {% endif %}
                                                    </td>
{#                                                    <td class="cen text-center"><a href="#"><i class="fas fa-edit"></i></a></td>#}
{#                                                                                        <td class="cen text-center"><a href="{% url 'user_detail' app_user.pub_id %}"><i class="fas fa-search"></i></a></td>#}
                                                </tr>
                                            {% endfor %}
                                        </table>
                                    {% endif %}
                                    <div class="col-md-12" style="border-bottom:1px dashed #898989;"></div>
{#                                    <div class="col-md-12 top15 text-right">#}
{#                                        <button type="submit" class="btn btn-default " style="background:#1f74a3;color:#fff">確認</button>#}
{#                                    </div>#}
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
{#            <div id="clock_in" class="tab-pane fade">#}
{#                <div class="row bottom40 top20">#}
{#                    <div class="col-md-12 col-sm-12 col-xs-12 " style="font-size: 16px;">#}
{#                        <table class="table table-striped table-bordered" >#}
{#                            <tr>#}
{#                                <th class="text-center cen_blue">日期</th>#}
{#                                <th class="text-center cen_blue">狀態</th>#}
{#                                <th class="text-center cen_blue">打卡地點</th>#}
{#                            </tr>#}
{#                            {% for record in attendance_record %}#}
{#                                <tr>#}
{#                                    <td class="cen text-center">{{ record.created | date:"Y-m-d H:i:s" }}</td>#}
{#                                    {% if record.status == record.ON_WORK %}#}
{#                                        <td class="cen text-center text-success" >{{ record.get_attendance_status_display }}</td>#}
{#                                    {% else %}#}
{#                                        <td class="cen text-center text-danger" >{{ record.get_attendance_status_display }}</td>#}
{#                                    {% endif %}#}
{#                                    <td class="cen text-center" ><a style="cursor: pointer;" onclick="place_tract('{{ record.approach_place.name }}')">{{ record.approach_place.name }}</a></td>#}
{#                                </tr>#}
{#                            {% endfor %}#}
{#                        </table>#}
{#                        <div class="center">#}
{#                            <ul class="pagination" style="float: left;">#}
{#                                <li class="page-item {% if not attendance_record.has_previous %}disabled{% endif %}">#}
{#                                    {% if attendance_record.has_previous %}#}
{#                                        <a href="{{ request.get_full_path|change_page:attendance_record.previous_page_number }}" aria-label="Previous">上頁 </a>#}
{#                                    {% else %}#}
{#                                        <a href="#" aria-label="Previous">上頁 </a>#}
{#                                    {% endif %}#}
{#                                </li>#}
{#                                {% for num in page_range %}#}
{#                                    <li class="page-item {% if num == attendance_record.number %}active{% endif %}"><a href="{{ request.get_full_path|change_page:num }}">{{ num }}</a></li>#}
{#                                {% endfor %}#}
{#                                <li class="page-item {% if not attendance_record.has_next %}disabled{% endif %}">#}
{#                                    {% if attendance_record.has_next %}#}
{#                                        <a href="{{ request.get_full_path|change_page:attendance_record.next_page_number }}" aria-label="Next">下頁 </a>#}
{#                                    {% else %}#}
{#                                        <a href="#" aria-label="Next">下頁 </a>#}
{#                                    {% endif %}#}
{#                                </li>#}
{#                            </ul>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
            <div id="approach" class="tab-pane fade">
                <div class="row bottom40 top20">
                    <div class="col-md-12 col-sm-12 col-xs-12 " style="font-size: 16px;">
                        <table class="table table-striped table-bordered" >
                            <tr>
                                <th class="text-center cen_blue">日期</th>
                                <th class="text-center cen_blue">被掃描者</th>
                                <th class="text-center cen_blue">掃描者</th>
                                <th class="text-center cen_blue">紀錄類型</th>
                                <th class="text-center cen_blue">健康碼</th>
{#                                <th class="text-center cen_blue">查看</th>#}
                            </tr>
                            {% for record in approach_record %}
                                <tr>
                                    <td class="cen text-center">{{ record.created | date:"Y-m-d H:i:s" }}</td>
                                    <td class="cen text-center">
                                        {% if record.app_user_link and record.app_user.pub_id != app_user.pub_id %}
                                            <a href="{% url 'staff_detail' request.session.company_manage_id_sel_now record.app_user.pub_id %}">{{ record.app_user.auth_user.first_name }}</a>
                                        {% else %}
                                            {{ record.app_user.auth_user.first_name }}
                                        {% endif %}
                                    </td>
                                    <td class="cen text-center">
                                        {% if record.scan_user_link and record.scan_user.pub_id != app_user.pub_id %}
                                            <a href="{% url 'staff_detail' request.session.company_manage_id_sel_now record.scan_user.pub_id %}">{{ record.scan_user.auth_user.first_name }}</a>
                                        {% else %}
                                            {{ record.scan_user.auth_user.first_name }}
                                        {% endif %}
                                    </td>
                                    <td class="cen text-center" >
                                        {% if record.type == record.APPROACH_CHECK %}
                                            接觸紀錄
                                        {% elif record.type == record.HEALTH_CHECK %}
                                            健康碼紀錄
                                        {% elif record.type == record.VISITOR_CHECK %}
                                            訪客紀錄
                                        {% endif %}
                                    </td>
                                    <td class="cen text-center" >
                                        {% if record.healthrecord %}{{ record.healthrecord.get_health_code_display }}{% endif %}
                                    </td>

{#                                    <td class="cen text-center"><a href="{% url 'user_detail' app_user.pub_id %}"><i class="fas fa-search"></i></a></td>#}
                                </tr>
                            {% endfor %}
                        </table>
                        <div class="center">
                            <ul class="pagination" style="float: left;">
                                <li class="page-item {% if not approach_record.has_previous %}disabled{% endif %}">
                                    {% if approach_record.has_previous %}
                                        <a href="{{ request.get_full_path|change_page2:approach_record.previous_page_number }}" aria-label="Previous">上頁 </a>
                                    {% else %}
                                        <a href="#" aria-label="Previous">上頁 </a>
                                    {% endif %}
                                </li>
                                {% for num in page_range2 %}
                                    <li class="page-item {% if num == approach_record.number %}active{% endif %}"><a href="{{ request.get_full_path|change_page2:num }}">{{ num }}</a></li>
                                {% endfor %}
                                <li class="page-item {% if not approach_record.has_next %}disabled{% endif %}">
                                    {% if approach_record.has_next %}
                                        <a href="{{ request.get_full_path|change_page2:approach_record.next_page_number }}" aria-label="Next">下頁 </a>
                                    {% else %}
                                        <a href="#" aria-label="Next">下頁 </a>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div id="place" class="tab-pane fade">
                <div class="row bottom40 top20">
                    <div class="col-md-12 col-sm-12 col-xs-12 " style="font-size: 16px;">
                        <table class="table table-striped table-bordered" >
                            <tr>
                                <th class="text-center cen_blue">日期</th>
                                <th class="text-center cen_blue">地點或位置</th>
                                <th class="text-center cen_blue">活動資訊</th>
{#                                <th class="text-center cen_blue">查看</th>#}
                            </tr>
                            {% for record in place_record %}
                                <tr>
                                    <td class="cen text-center">{{ record.created | date:"Y-m-d H:i:s" }}</td>
                                    <td class="cen text-center" >
                                        {% if record.place_tract %}
                                            <a style="cursor: pointer;" onclick="place_tract('{{ record.place_location }}')">{{ record.place_location }}</a>
                                        {% else %}
                                            {{ record.place_location }}
                                        {% endif %}
                                    </td>
                                    <td class="cen text-center" >
                                        {% if record.note.act_name %}
                                            活動名稱：{{ record.note.act_name }}
                                        {% endif %}
                                        {% if record.note.act_organizer %}
                                            {% if record.note.act_name %} <br> {% endif %}
                                            主辦單位：{{ record.note.act_organizer }}
                                        {% endif %}
                                        {% if record.note.act_org_contact %}
                                            {% if record.act_name or record.note.act_organizer %} <br> {% endif %}
                                            聯絡人/電話：{{ record.note.act_org_contact }}
                                        {% endif %}
                                    </td>
                                </tr>
                            {% endfor %}
                        </table>
                        <div class="center">
                            <ul class="pagination" style="float: left;">
                                <li class="page-item {% if not place_record.has_previous %}disabled{% endif %}">
                                    {% if place_record.has_previous %}
                                        <a href="{{ request.get_full_path|change_page3:place_record.previous_page_number }}" aria-label="Previous">上頁 </a>
                                    {% else %}
                                        <a href="#" aria-label="Previous">上頁 </a>
                                    {% endif %}
                                </li>
                                {% for num in page_range3 %}
                                    <li class="page-item {% if num == place_record.number %}active{% endif %}"><a href="{{ request.get_full_path|change_page3:num }}">{{ num }}</a></li>
                                {% endfor %}
                                <li class="page-item {% if not place_record.has_next %}disabled{% endif %}">
                                    {% if place_record.has_next %}
                                        <a href="{{ request.get_full_path|change_page3:place_record.next_page_number }}" aria-label="Next">下頁 </a>
                                    {% else %}
                                        <a href="#" aria-label="Next">下頁 </a>
                                    {% endif %}
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block js %}
    <script>
        function place_tract(place_name) {
            var api_url = "{% url 'company_tract' 'COMPANY_ID' %}";
            api_url = api_url.replace('COMPANY_ID', '{{ request.session.company_manage_id_sel_now }}');
            api_url = api_url + '?place_name=' + place_name;
            {#alert(api_url);#}
            location.href = api_url;
        }
        $(document).ready(function(){
            if ('{{ nav_no_reset }}' != 1){
                localStorage.removeItem('activeTab')
            }
            $('a[data-toggle="tab"]').on('show.bs.tab', function(e) {
                localStorage.setItem('activeTab', $(e.target).attr('href'));
            });
            var activeTab = localStorage.getItem('activeTab');
            if(activeTab){
                $('#myTab a[href="' + activeTab + '"]').tab('show');
            }
        });
    </script>
{% endblock %}