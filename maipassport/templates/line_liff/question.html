{% extends 'line_liff/base.html' %}
{% load static %}
{% load i18n %}
{% block stylesheet %}
    <style>
    .label  .q-title-black{
        color: black;
    }

    .label  .q-title-white{
        color: white;
    }

</style>
{% endblock %}
{% block content %}
    <div class="container">
        <h6 class="subtitle">{% trans 'Health Declaration' %}</h6>
        <form action="{% url 'liff_declaration' %}" method="post" id="frm">
            {% csrf_token %}
{#            <input type="hidden" id="web_latitude" name="web_latitude">#}
{#            <input type="hidden" id="web_longitude" name="web_longitude">#}
            <input type="hidden" id="latitude" name="latitude">
            <input type="hidden" id="longitude" name="longitude">
            <div id="table_field">
                <div class="row">
                    <div class="col-12 col-md-6">
                        <div class="form-group float-label active" >
                            <input type="text" class="form-control text-template" id="id_username" style="font-size: 18px;" value="{{ request.user.first_name }}" readonly>
                            <label class="form-control-label " style="font-size: 18px;">{% trans 'Filled by' %}</label>
                        </div>
                    </div>
                </div>
                <div style="height: 10px;"></div>
{#                <div class="row">#}
{#                    <div class="col-12 col-md-6">#}
{#                        <div class="form-group float-label active">#}
{#                            <div style="height: 15px;"></div>#}
{#                            <div class="input-group-prepend">#}
{#                                <div >&nbsp;</div>#}
{#                                <div class="input-group-text" style="background-color: transparent; border:0;">#}
{#                                    <input type="checkbox" aria-label="Checkbox for following text input" onclick="default_checked()">#}
{#                                    <p class="text-template" style="font-size: 20px;">&nbsp;&nbsp;以上皆無</p>#}
{#                                </div>#}
{#                            </div>#}
{#                            <label class="form-control-label " style="font-size: 18px;">3.目前在境外或14天內有出國旅遊者</label>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#                            <div class="row">#}
{#                                <div class="col-12 col-md-6">#}
{#                                    <div class="form-group float-label active">#}
{#                                        <div class="input-group-prepend">#}
{#                                            <div>&nbsp;</div>#}
{#                                            <div class="input-group-text" style="background-color: transparent; border:0;">#}
{#                                                <input type="checkbox" aria-label="Checkbox for following text input" name="qqq1" value="1114" id="1114">#}
{#                                                <p class="text-template" style="font-size: 20px;">&nbsp;&nbsp;33</p>#}
{#                                            </div>#}
{#                                            <div>&nbsp;</div>#}
{#                                            <div class="input-group-text" style="background-color: transparent; border:0;">#}
{#                                                <input type="checkbox" aria-label="Checkbox for following text input" name="qqq1" value="1113" >#}
{#                                                <p class="text-template" style="font-size: 20px;">&nbsp;&nbsp;33</p>#}
{#                                            </div>#}
{#                                            <div>&nbsp;</div>#}
{#                                            <div class="input-group-text" style="background-color: transparent; border:0;">#}
{#                                                <input type="checkbox" aria-label="Checkbox for following text input" name="qqq1" value="1112" >#}
{#                                                <p class="text-template" style="font-size: 20px;">&nbsp;&nbsp;33</p>#}
{#                                            </div>#}
{#                                        </div>#}
{#                                        <span ><p id="agreeRule"></p></span>#}
{#                                        <label class="form-control-label " style="font-size: 20px;">0. 333</label>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}

            </div>
            <div style="height: 10px;"></div>
            <button type="button" onclick="frm_send()" class="btn btn-lg btn-default text-white btn-block btn-rounded shadow" id="btn_send" ><span>{% trans 'Submit' %}</span></button>
            <div style="height: 10px;"></div>
{#            <a href="{% url 'liff_qr_code' %}" class="btn btn-lg btn-default text-white btn-block btn-rounded shadow" style="background-color: #939393;"><span>{% trans 'Back' %}</span></a>#}
            <a onclick="liff.closeWindow();" class="btn btn-lg btn-default text-white btn-block btn-rounded shadow" style="background-color: #939393;"><span>{% trans 'Close' %}</span></a>

        </form>
    </div>



{% endblock %}
{% block js %}
    <script>
    var field_length = 0;
    var check_array = [];
    function clear_form(){
        document.getElementById('frm').reset();
    }
    function count_field(){
        for (var i in field_length){
            document.getElementsByName('field__' + i);
        }
    }
    function remove_validity(input) {
        input.setCustomValidity('');
    }
    function frm_send(){
        var check;
        var field_name;

        for (var i in check_array){
            field_name = check_array[i];

            check=$('input[name='+ field_name + ']:checked').length;
            var x = document.getElementById(field_name);
            if (check == 0) {
                x.setCustomValidity('{% trans "Please tick these options" %}');
                {#x.reportValidity();#}
            }else{
                x.setCustomValidity('');
            }
        }
        var frm = $("#frm");
        if (frm[0].checkValidity()){
            $("#frm").submit();
        }else{
            frm[0].reportValidity();
        }
    }
    function default_checked(){
        var field_name, x;
        if ($('#all_checkbox').prop('checked') == true){
            for (var i in check_array){
                field_name = check_array[i];
                {#x = document.getElementById(field_name);#}
                {#x.setAttribute('checked', true);#}
                $("#" + field_name).prop("checked", true);
            }
        }else{
            for (var i in check_array){
                field_name = check_array[i];
                {#x = document.getElementById(field_name);#}
                {#x.removeAttribute('checked');#}
                $("#" + field_name).prop("checked", false);
            }
        }
    }
    function setLocationData(latitude, longitude){
        $('#latitude').val(latitude);
        $('#longitude').val(longitude);
    }
    $(document).ready(function() {
        {#if ('{{ declaration_status }}' == 'FINISH'){#}
        {#    $("#declaration_finish_modal").modal();#}
        {# }#}
        check_array = [];
        document.getElementsByTagName("title")[0].innerText = '{% trans "Health Declaration" %}' + ' · ' + '{% trans "My PassCode" %}';

        var request_device = '{{ request.session.DEVICE}}';
        if (request_device == "ANDROID"){
            getLocationFunc();
        }else{
            getLocation();
        }

        var fn_dict = {{ html_context|safe }};
        {#alert(fn_dict);#}
        var field_name_list = fn_dict['field_trans_name'];
        var field_type_list = fn_dict['field_type'];
        var field_list = fn_dict['field'];

        field_length = field_name_list.length;
        {#alert(field_length);#}

        for (var i in field_name_list){
            var num = parseInt(i) + 1;
            var y;
            var field_type = field_type_list[i];
            var html_str;
            if (field_type == 'Number') {
                html_str = '';
                html_str += '<div class="row"><div class="col-12 col-md-6"><div class="form-group float-label active"';
                if ('{{ request.COOKIES.language }}' == 'en-us'){
                    if (72 > field_name_list[i].length &&  field_name_list[i].length > 40){
                        html_str += ' style="padding-top:40px;"'
                    }else if (field_name_list[i].length >= 72){
                        html_str += ' style="padding-top:50px;"'
                    }
                }
                html_str += '><input type="number" step="0.1" maxlength=4 class="form-control text-template" style="font-size:20px;" name="field__' + i + '" placeholder="'+ '{% trans "Please enter" %}' + field_name_list[i] + '" required';
                {#alert(field_name_list[i]);#}
                if (field_name_list[i] == '今日額溫(填寫至小數點第1位)'){
                    html_str += ' value=36.5'
                }else if (field_name_list[i] == "Today\'s body/forehead temperature (fill in to the first decimal place)"){
                    html_str += ' value=36.5'
                }
                html_str += '><label class="form-control-label" ';
                if (field_name_list[i] == "Today\'s body/forehead temperature (fill in to the first decimal place)"){
                    html_str += 'style="font-size: 18px; padding-top:-10px;">' + num + '. ' + field_name_list[i] + '</label></div></div></div>';

                }else{
                    html_str += 'style="font-size: 18px;">' + num + '. ' + field_name_list[i] + '</label></div></div></div>';
                }
                document.getElementById('table_field').innerHTML += html_str;
            }else if (field_type == 'Text'){
                html_str = '';
                html_str += '<div class="row"><div class="col-12 col-md-6"><div class="form-group float-label active"';
                if ('{{ request.COOKIES.language }}' == 'en-us'){
                    if (72 > field_name_list[i].length > 40){
                        html_str += ' style="padding-top:30px;"'
                    }else if (field_name_list[i].length >= 72){
                        html_str += ' style="padding-top:40px;"'
                    }
                }
                html_str += '><input type="text" class="form-control text-template" style="font-size:20px;" name="field__' + i + '" placeholder="' + '{% trans "Please enter" %}' + field_name_list[i] +'" required><label class="form-control-label" ' +
                    'style="font-size: 18px;">' + num + '. ' + field_name_list[i] + '</label></div></div></div>';
                document.getElementById('table_field').innerHTML += html_str
            }else if (field_type == 'Radio'){
                html_str = '';
                html_str += '<div class="row"><div class="col-12 col-md-6"><div class="form-group float-label active"';
                if ('{{ request.COOKIES.language }}' == 'en-us'){
                    if (72 > field_name_list[i].length > 40){
                        html_str += ' style="padding-top:30px;"'
                    }else if (field_name_list[i].length >= 72){
                        html_str += ' style="padding-top:40px;"'
                    }
                }
                html_str += '><div class="input-group-prepend">';
                for (y in field_list[i]){
                    html_str += '<div>&nbsp;</div><div class="input-group-text"><input type="radio" aria-label="Radio for following text input" ' +
                        'name="field__'+ i + '" value="'+ field_list[i][y] + '"><p style="font-size: 20px;" id="p_'+ i + '_' + y +'">&nbsp;&nbsp;'+ field_list[i][y] + '</p></div>';
                }
                html_str += '</div><label class="form-control-label text-template" style="font-size: 18px;">'+ num + '. ' + field_name_list[i] + '</label></div></div></div>';
                document.getElementById('table_field').innerHTML += html_str;
            }else if (field_type == 'Checkbox'){
                check_array.push('field__' + i);
                html_str = '';
                html_str += '<div class="row"><div class="col-12 col-md-6"><div class="form-group float-label active"';
                if ('{{ request.COOKIES.language }}' == 'en-us'){
                    if (72 > field_name_list[i].length > 40){
                        html_str += ' style="padding-top:30px;"'
                    }else if (field_name_list[i].length >= 72){
                        html_str += ' style="padding-top:40px;"'
                    }
                }
                html_str += '>';
                if (field_name_list[i].length > 12){
                    html_str += '<div style="height: 15px;"></div>';
                }else if(field_name_list[i].length > 24){
                    html_str += '<div style="height: 30px;"></div>';
                }
                html_str += '<div class="input-group-prepend">';
                for (y in field_list[i]){
                    html_str += '<div>&nbsp;</div><div class="input-group-text" style="background-color: transparent; border:0;"><input type="checkbox" aria-label="Checkbox for following text input" ' +
                        'name="field__'+ i + '" value="'+ field_list[i][y] + '" onclick="remove_validity(this)" ';
                    if (y == 0){
                        html_str += 'id="field__' + i + '" '
                    }
                    html_str += '><p class="text-template" style="font-size: 20px; " id="p_'+ i + '_' + y +'">&nbsp;&nbsp;'+ field_list[i][y] + '</p></div>';
                }
                html_str += '</div><label class="form-control-label " style="font-size: 18px;">'+ num + '. ' + field_name_list[i] +'</label></div></div></div>';
                document.getElementById('table_field').innerHTML += html_str;
            }
        }
        document.getElementById('table_field').innerHTML += '<div class="row"><div class="col-12 col-md-6"><div class="form-group float-label active"><div class="input-group-prepend">' +
            '<div>&nbsp;</div><div class="input-group-text" style="background-color: transparent; border:0;"><input type="checkbox" id="all_checkbox" onclick="default_checked()">' +
            '<p class="text-template" style="font-size: 20px;">&nbsp;&nbsp;'+ '{% trans "None of the above" %}' + '</p></div></div>' +
            '</div></div></div>';
        var theme_color_layout = $.cookie("theme-color-layout");
        var theme_color = $.cookie("theme-color");
        if (theme_color_layout == 'theme-dark'){
            $('.label').removeClass('q-title-black q-title-white');
            $('.label').addClass('q-title-black');
            $('.h').addClass('q-title-black');
        }else{
            $('.label').removeClass('q-title-black q-title-white');
            $('.label').addClass('q-title-white');
            $('.h').addClass('q-title-white');
        }
        var s;
        if (theme_color == 'black-theme' && theme_color_layout == 'theme-dark'){
            s=document.getElementsByTagName('p');
            for(i=0;i<s.length;i++)
            {
                s[i].setAttribute("style","color:white");
            }
            document.getElementById('btn_send').style.backgroundColor = '#2c2c2c';
            document.getElementById('id_username').style.color = 'white';
            s=document.getElementsByTagName('input');
            for(i=0;i<s.length;i++)
            {
                s[i].setAttribute("style","color:white");
            }
        }

        if (request_device == "ANDROID"){
            var timer = null, interval = 1000, value = 0;

            timer = setInterval(function () {
                if ($("#latitude").val() == '' && $("#longitude").val() == '' ) {
                    value += 1;
                    if (value > 10){
                        clearInterval(timer);
                        getLocation();
                        value = 0;
                        timer = setInterval(function () {
                            if ($("#latitude").val() == '' && $("#longitude").val() == '' ) {
                                value += 1;
                                if (value > 10){
                                    clearInterval(timer);
                                    {#$("#msg").text('取得地址錯誤：取得位置失敗');#}
                                    {#$("#message_modal").modal();#}
                                }
                            }else{
                                clearInterval(timer);
                            }}, interval);
                    }}else{
                    clearInterval(timer);}
            }, interval);
        }
    })
</script>
{% endblock %}