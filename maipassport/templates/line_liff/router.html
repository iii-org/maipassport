{% load static %}
{% load i18n %}
<!doctype html>
<html lang="en" class="deeppurple-theme">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, viewport-fit=cover, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="Maxartkiller">

    <title></title>

    <!-- Material design icons CSS -->
    <link rel="stylesheet" href="{% static 'app_web/vendor/materializeicon/material-icons.css' %}">

    <!-- Roboto fonts CSS -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet">

    <!-- Bootstrap core CSS -->
    <link href="{% static 'app_web/vendor/bootstrap-4.4.1/css/bootstrap.min.css' %}" rel="stylesheet">

    <!-- Swiper CSS -->
    <link href="{% static 'app_web/vendor/swiper/css/swiper.min.css' %}" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="{% static 'app_web/css/style.css' %}" rel="stylesheet">
    <style>
        .row {
            margin-right: 1px;
        }

        .crop img {
            width: 80px;
            height: 100px;
            margin: -25px 0 0 -10px;
        }

        {# 深色模式 logo #}
        .theme-dark .header-logo {
            /*content: url('../img/logo-header-white.png');*/
            {#content: url({% static 'app_web/img/logo-04a.png' %});#}
            {% if request.session.iii_login %}
                content: url({% static 'app_web/img/main_logo_white.png' %});
            {% else %}
                content: url({% static 'app_web/img/logo-04a.png' %});
            {% endif %}
        }

        .theme-dark .logo-small {
            /*content: url('../img/logo-login-white.png');*/
            {% if request.session.iii_login %}
                content: url({% static 'app_web/img/main_logo_white.png' %});
            {% else %}
                content: url({% static 'app_web/img/logo-04a.png' %});
            {% endif %}
        }
        .logo-small {
            /*content: url('../img/logo-login-white.png');*/
            {% if not request.session.iii_login %}
                width: 250px;
            {% endif %}
        }
        .ix_bar{}
    </style>
    {% block stylesheet %}{% endblock %}
    <style>
        /* iPhone X and Xs Max */
        @media only screen
            and (min-device-width: 375px)
            and (min-device-height: 812px)
            and (-webkit-device-pixel-ratio: 3)
            and (orientation: portrait) {
                /* styles */

                .header {
                    height: env(safe-area-inset-top);
                    padding: env(safe-area-inset-top);
                }

                .contentinfo{
                    /*padding: 44px 3% 0 3%;*/
                    padding: env(safe-area-inset-top) 3% 0 3%;
                }
                .ix_bar{
                    height: 30px;
                }
                .header .btn {
                    text-align: left;
                    width: 30px;
                }
            }

        /* iPhone XR */
        @media only screen
            and (min-device-width: 414px)
            and (min-device-height: 896px)
            and (-webkit-device-pixel-ratio: 2)
            and (orientation: portrait) {
                /* styles */

                .header {
                    height: env(safe-area-inset-top);
                    padding: env(safe-area-inset-top);
                }

                .contentinfo{
                    padding: env(safe-area-inset-top) 3% 0 3%;
                }
                .ix_bar{
                    height: 30px;
                }
                .header .btn {
                    text-align: left;
                    width: 30px;
                }
            }
    </style>
</head>
<body>
<!-- Loader -->
    <div class="row no-gutters vh-100 bg-template loader-screen " id="loader_page">
        <div class="col align-self-center text-center">
{#            <img src="{% static 'app_web/img/main_logo_white.png' %}" alt="logo" class="logo-small">#}
{#            <img src="{% static 'app_web/img/logo-04a.png' %}" alt="logo" class="logo-small">#}
            {% if request.session.iii_login %}
                <img src="{% static 'app_web/img/main_logo_white.png' %}" alt="logo" class="logo-small">
            {% else %}
                <img src="{% static 'app_web/img/logo-04a.png' %}" alt="logo" class="logo-small">
            {% endif %}
{#            <h1 class="mt-3"><span class="font-weight-light ">我的</span>通行碼</h1>#}
            <h1 class="mt-3">{% trans 'MY PASSCODE' %}</h1>

            <div class="laoderhorizontal">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </div>
    <!-- Loader ends -->

<div>
    <form action="{% url 'liff_router' %}" method="post" id="frm">
        {% csrf_token %}
{#        <input type="hidden" name="func_type" value="{{ func_type }}">#}
        <input type="hidden" name="user_id" id="user_id">
        <input type="hidden" name="device_os" id="device_os">

    </form>
</div>
<!-- jquery, popper and bootstrap js -->
<script src="{% static 'app_web/js/jquery-3.6.0.min.js' %}"></script>
<script src="{% static 'app_web/js/popper.min.js' %}"></script>
<script src="{% static 'app_web/vendor/bootstrap-4.4.1/js/bootstrap.min.js' %}"></script>

<!-- swiper js -->
<script src="{% static 'app_web/vendor/swiper/js/swiper.min.js' %}"></script>

<!-- cookie js -->
<script src="{% static 'app_web/vendor/cookie/jquery.cookie.js' %}"></script>

<!-- template custom js -->
<script src="{% static 'app_web/js/main.js' %}"></script>
<script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
<script>
    function initializeLiff(myLiffId, redirectUrl) {
        liff.init({
            liffId: myLiffId
        })
            .then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login({ redirectUri: redirectUrl });
                }else{
                    {#document.getElementById('idToken').innerHTML =  liff.getIDToken();#}
                    liff.getProfile()
                        .then(profile => {
                            $('#user_id').val(profile.userId);
                            $('#device_os').val(liff.getOS());
                            $('#frm').submit();
                        })
                        .catch((err) => {
                            alert(err);
                            alert(err.code);
                        });
                }
            })
            .catch((err) => {
                alert(err);
            });
    }
    $(document).ready(function(){
        var redirectUrl = "https://" + "{{ LIFF_REDIRECT_URL }}" + "/line/router/";
        redirectUrl = redirectUrl + '?func_type=' + '{{ request.session.func_type }}' + '&language=' + '{{ request.COOKIES.language }}';
        initializeLiff('{{ request.session.LIFF_ID }}', redirectUrl);
     });



</script>
</body>

</html>